<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Projetos | MBBIM Consultoria & Inovação</title>
  <meta name="description"
        content="Projetos selecionados em BIM, planejamento 4D, quantificação, automações e implantação de processos digitais.">
  <link rel="stylesheet" href="css/styles.css" />

  <!-- fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Sora:wght@400;500;600;700&display=swap"
        rel="stylesheet">

  <style>
    /* --- Ajustes da imagem principal --- */
    .project-detail-image img {
      width: 100%;
      max-height: 420px;
      object-fit: contain;
      border-radius: 12px;
      background: #0f1a20;
      cursor: zoom-in;
    }

    /* --- Modal/Popup da imagem --- */
    #image-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.85);
      z-index: 9999;
      padding: 40px;
    }
    #image-modal img {
      max-width: 90vw;
      max-height: 90vh;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 0 25px rgba(0,0,0,0.6);
    }
    #image-modal .modal-close {
      position: absolute;
      top: 30px;
      right: 40px;
      font-size: 32px;
      background: rgba(0,0,0,0.6);
      border-radius: 50%;
      color: white;
      width: 46px;
      height: 46px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <!-- Navbar -->
  <header class="navbar">
    <div class="container nav-content">
      <div class="logo-area">
        <img src="img/logo-mbbim-branco.png" alt="MBBIM Consultoria &amp; Inovação" class="logo-img">
      </div>

      <button class="nav-toggle" aria-label="Abrir menu">☰</button>

      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="sobre.html">Sobre</a>
        <a href="servicos.html">Serviços</a>
        <a href="projetos.html">Projetos</a>
        <a href="contato.html">Contato</a>
      </nav>
    </div>
  </header>

  <main>

    <!-- Lista de projetos -->
    <section class="section" id="projetos-lista">
      <div class="container">
        <span class="section-eyebrow">Portfólio</span>
        <h1>Projetos selecionados</h1>
        <p class="section-subtitle">
          Uma amostra dos trabalhos realizados com BIM, planejamento 4D, automações e implantação de processos
          digitais em ambientes de projeto e obra.
        </p>

        <div class="portfolio-grid" id="portfolio-grid-projetos">
          <!-- Cards renderizados via JS -->
        </div>
      </div>
    </section>

    <!-- Detalhe do projeto -->
    <section class="section section-alt" id="projeto-detalhe">
      <div class="container project-detail-grid">
        <div class="project-detail-image">
          <img src="" alt="" id="project-detail-image">
        </div>
        <div class="project-detail-text">
          <h2 id="project-detail-title"></h2>
          <ul class="portfolio-tags" id="project-detail-tags"></ul>
          <p id="project-detail-body"></p>
        </div>
      </div>
    </section>

  </main>

  <!-- Popup -->
  <div id="image-modal">
    <div class="modal-close" id="modal-close">✕</div>
    <img src="" alt="Imagem ampliada" id="modal-img">
  </div>

  <!-- Rodapé -->
  <footer class="footer">
    <div class="container footer-content">
      <p>© <span id="year"></span> MBBIM Consultoria &amp; Inovação. Todos os direitos reservados.</p>
      <p class="footer-secondary">
        Focado em BIM, dados e processos para projetos mais eficientes.
      </p>
    </div>
  </footer>

  <script>
    /* importa o mesmo array PROJECTS da home */
    const PROJECTS = window.PROJECTS || [...]; // ← substituído automaticamente pelo browser caso esteja no global

    const gridProjetos = document.getElementById("portfolio-grid-projetos");
    const imgDetail = document.getElementById("project-detail-image");
    const titleDetail = document.getElementById("project-detail-title");
    const tagsDetail = document.getElementById("project-detail-tags");
    const bodyDetail = document.getElementById("project-detail-body");

    /* Render dos cards (sem imagem!) */
    function renderProjectsGrid(activeId) {
      gridProjetos.innerHTML = "";

      PROJECTS.forEach((p) => {
        const card = document.createElement("article");
        card.className = "portfolio-card" + (p.id === activeId ? " active" : "");

        card.innerHTML = `
          <button class="portfolio-card-button" type="button" data-project-id="${p.id}">
            <div class="portfolio-body">
              <h3>${p.title}</h3>
              <p>${p.shortDescription}</p>
              <ul class="portfolio-tags">
                ${p.tags.map(tag => `<li>${tag}</li>`).join("")}
              </ul>
            </div>
          </button>
        `;

        gridProjetos.appendChild(card);
      });

      document.querySelectorAll(".portfolio-card-button").forEach(btn => {
        btn.addEventListener("click", () => {
          setActiveProject(btn.dataset.projectId, true);
        });
      });
    }

    /* Atualiza projeto selecionado */
    function setActiveProject(id, updateUrl) {
      const project = PROJECTS.find(p => p.id === id) || PROJECTS[0];

      imgDetail.src = project.image;
      imgDetail.alt = project.title;
      titleDetail.textContent = project.title;
      tagsDetail.innerHTML = project.tags.map(t => `<li>${t}</li>`).join("");
      bodyDetail.textContent = project.detail;

      renderProjectsGrid(project.id);

      if (updateUrl) {
        const params = new URLSearchParams(window.location.search);
        params.set("projeto", project.id);
        history.replaceState({}, "", `${window.location.pathname}?${params}`);
      }
    }

    /* Projeto inicial */
    const query = new URLSearchParams(location.search);
    const initialId = query.get("projeto") || PROJECTS[0].id;

    renderProjectsGrid(initialId);
    setActiveProject(initialId, false);

    /* Atualiza ano */
    document.getElementById("year").textContent = new Date().getFullYear();

    /* Toggle mobile menu */
    const navToggle = document.querySelector(".nav-toggle");
    const navLinks = document.querySelector(".nav-links");
    navToggle.addEventListener("click", () => navLinks.classList.toggle("nav-open"));

    /* ------- Popup da imagem ------- */
    const modal = document.getElementById("image-modal");
    const modalImg = document.getElementById("modal-img");
    const closeBtn = document.getElementById("modal-close");

    imgDetail.addEventListener("click", () => {
      modalImg.src = imgDetail.src;
      modal.style.display = "flex";
    });

    closeBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    modal.addEventListener("click", (e) => {
      if (e.target === modal) modal.style.display = "none";
    });

  </script>

</body>
</html>
